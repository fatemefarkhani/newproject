# -*- coding: utf-8 -*-
"""create dataset.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1nbEXMSTqRU1xz4pqhSvkac6EaiPWWkbm
"""

from google.colab import drive
drive.mount('/content/drive')

!wget http://jmcauley.ucsd.edu/data/amazon/qa/icdm/QA_Video_Games.json.gz

import json
import gzip

def parse(path):
  g = gzip.open(path, 'r')
  for l in g:
    yield json.dumps(eval(l))

f = open("output.strict", 'w')
for l in parse("qa_Video_Games.json.gz"):
  f.write(l + '\n')

data = []
with open('/content/drive/My Drive/json/output.strict') as f:
   for l in f:
        data.append(json.loads(l.strip()))

df3=pd.json_normalize(data,['questions','answers'],['asin',['questions','questionType'],['questions','askerID'],['questions','questionTime'],['questions','questionText']])

df3.rename(columns={"questions.questionText":"questionText","questions.askerID":"askerID"},inplace=True)
df3.columns

df3.drop(["questionType", "askerID","questionTime","answerTime","answerType"], axis = 1,inplace = True)

df3.insert(1,"label",0)
df3.drop(["answererID"], axis = 1,inplace = True)

"""remove data that have no vote and set label for remain rows"""

l_count=0
m=0
l=len(df3)
for i in range(l) :
  if  df3.helpful[i][0]==df3.helpful[i][1] and df3.helpful[i][1]>=2 : 
    if df3.helpful[i][0]>=3  :
      df3.label[i]=1
      l_count=l_count+1  
  else :  
    df3.drop([i],inplace=True)
    m=m+1  
print('m ',m,'l_count',l_count,'shape',df3.shape)